%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Short Sectioned Assignment
% LaTeX Template
% Version 1.0 (5/5/12)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% Original author:
% Frits Wenneker (http://www.howtotex.com)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[paper=a4, fontsize=11pt]{scrartcl} % A4 paper and 11pt font size

\usepackage[T1]{fontenc} % Use 8-bit encoding that has 256 glyphs
\usepackage{fourier} % Use the Adobe Utopia font for the document - comment this line to return to the LaTeX default
\usepackage[english]{babel} % English language/hyphenation

\usepackage{lipsum} % Used for inserting dummy 'Lorem ipsum' text into the template

\usepackage{sectsty} % Allows customizing section commands
\allsectionsfont{ \normalfont\scshape} % Make all sections centered, the default font and small caps
\usepackage{cite}
\usepackage{listings}

%%%%%---------------------------%%%%%%%%%%%
\usepackage{fancybox}
\usepackage{graphicx}
\usepackage{pdfpages}
\usepackage{color}
\usepackage{epstopdf}
\usepackage[margin=1in, vmargin=1in]{geometry}
\usepackage{mathtools}
\usepackage{float}
\usepackage{listings}
\usepackage{verbatim}
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{longtable, array}
\usepackage{movie15}
\usepackage{hyperref}
\usepackage{subcaption}
\usepackage{enumerate}
\usepackage{hyperref}
\usepackage{bashful}

\usepackage{multicol}
\usepackage{booktabs} % For \toprule, \midrule and \bottomrule
\usepackage{siunitx} % Formats the units and values
\usepackage{pgfplotstable} % Generates table from .csv

%%%%%%%%%%%%%%---------------%%%%%%%%


\usepackage{fancyhdr} % Custom headers and footers
\pagestyle{fancyplain} % Makes all pages in the document conform to the custom headers and footers
\fancyhead{} % No page header - if you want one, create it in the same way as the footers below
\fancyfoot[L]{} % Empty left footer
\fancyfoot[C]{} % Empty center footer
\fancyfoot[R]{\thepage} % Page numbering for right footer
\renewcommand{\headrulewidth}{0pt} % Remove header underlines
\renewcommand{\footrulewidth}{0pt} % Remove footer underlines
\setlength{\headheight}{13.6pt} % Customize the height of the header

\numberwithin{equation}{section} % Number equations within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)
\numberwithin{figure}{section} % Number figures within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)
\numberwithin{table}{section} % Number tables within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)

\setlength\parindent{0pt} % Removes all indentation from paragraphs - comment this line for an assignment with lots of text

%%%%%%%%CODE INPUT STYLES%%%%%%%%%%%%%
\lstdefinestyle{BashInputStyle}{
  language=bash,
  firstline=2,% Supress the first line that begins with `%`
  basicstyle=\small\sffamily,
  numbers=left,
  numberstyle=\tiny,
  numbersep=3pt,
  frame=tb,
  columns=fullflexible,
  backgroundcolor=\color{yellow!20},
  linewidth=0.9\linewidth,
  xleftmargin=0.1\linewidth
}

\lstdefinestyle{BashOutputStyle}{
  basicstyle=\small\ttfamily,
  numbers=none,
  frame=tblr,
  columns=fullflexible,
  backgroundcolor=\color{blue!10},
  linewidth=0.9\linewidth,
  xleftmargin=0.1\linewidth
}


% settings for listings
\lstset{
    basicstyle=\scriptsize,
    numbers=left,
    numberstyle=\scriptsize,
    stepnumber=1,
    numbersep=5pt,
    showspaces=false, % don't show spaces by adding underscores
    showstringspaces=false, % don't underline spaces in strings
    showtabs=false, % don't show tabs with underscores
    frame=shadowbox,
    tabsize=4,
    captionpos=b,
    breaklines=true,
    breakatwhitespace=false,
    keywordstyle=\color{blue!70},
    commentstyle=\color{red!50!green!50!blue!50},
    rulesepcolor=\color{red!20!green!20!blue!20},
    numberbychapter=false,
    stringstyle=\ttfamily %typewriter type for strings
}
\hypersetup{
colorlinks=true,
linkcolor=black,
citecolor=black,
urlcolor=black
}

%----------------------------------------------------------------------------------------
%	TITLE SECTION
%----------------------------------------------------------------------------------------

\newcommand{\horrule}[1]{\rule{\linewidth}{#1}} % Create horizontal rule command with 1 argument of height

\title{	
\normalfont \normalsize 
\textsc{Introduction to Web Science- Fall 2014} \\ [25pt] % Your university, school and/or department name(s)
\horrule{0.5pt} \\[0.4cm] % Thin top horizontal rule
\huge Assignment Ten \\ % The assignment title
\horrule{2pt} \\[0.5cm] % Thick bottom horizontal rule
}

\author{Sybil Melton} % Your name

\date{\normalsize\today} % Today's date or a custom date

\begin{document}

\maketitle % Print the title
\newpage
\tableofcontents
%\listoffigures
\listoftables
\lstlistoflistings
\newpage
%----------------------------------------------------------------------------------------
%	TASK 1
%----------------------------------------------------------------------------------------

\section{Blog Retrieval}
Choose a blog or a newsfeed (or something similar as long as it has
an Atom or RSS feed).  It should be on a topic or topics of which you
are qualified to provide classification training data.  In other words,
choose something that you enjoy and are knowledgable of.  Find a feed
with at least 100 entries.

Create between four and eight different categories for the entries
in the feed.

Download and process the pages of the feed as per the week 12 
class slides.

\subsection{Solution}
To find a blog, I used the ``next blog'' functionality to randomly choose one until I found one with a technology topic and more than 100 entries.
The particular blog I chose is titled ``The Invisible Things Lab's blog.''
The description is Kernel, Hypervisor, Virtualization, Trusted Computing and other system-level security stuff, which I have knowledge
of from work and my studies at ODU.
I used requests, feedparser, and BeautifulSoup to get the blog pages and parse the feed.
I retrieved the first four pages and saved the entries in a list, to be filtered later.
The content still had some markup language and illegal XML characters, so I used the same functions I created for assignment nine
to remove them.
Listing \ref{code:blog} is the code used to accomplish the first part of this task.\cite{bib:collective}

\lstset{
    caption={Retrieve Blog},
     label=code:blog
}
\lstinputlisting[language=Python, firstline=10, lastline=47]{classify.py}

As I read the entries, I chose announcements, security, hardware, os, and paper as the categories.  Announcements was for general announcements.  Security was for any entry about cybersecurity.  Hardware entries discussed chipset and DRAM.  Os handled any general articles about operating systems that did not fit into security, and paper handled any blogs that just posted white papers or slides from conferences.

%----------------------------------------------------------------------------------------
%	TASK 2
%----------------------------------------------------------------------------------------
\section{Classification}
Manually classify the first 50 entries, and then classify (using
the fisher classifier) the remaining 50 entries. Report the cprob()
values for the 50 titles as well.  From the title or entry itself,
specify the 1-, 2-, or 3-gram that you used for the string to
classify.  Do not repeat strings; you will have 50 unique strings.

Create a table with the title, the string used for classification,
cprob(), predicted category, and actual category.

\subsection{Solution}
My program set up the fisher classifier and database.
The database was ``feed.db'' and is included with this report.
Then feedfilter was used to manually classify the first 50 entries, train the classifier, and guess a classification for the remaining 50.
Listing \ref{code:setup} is the code used to accomplish the next task.\cite{bib:collective}

\lstset{
    caption={Set Up Classifier},
     label=code:setup
}
\lstinputlisting[language=Python, firstline=49, lastline=52]{classify.py}

I modified feedfilter.py to classify the entries.  
I changed the read function to accept my list of entries, so the list could be split between the first and second 50 entries.
The `summary' token was changed to the content value, because I found some entries were cut off because of the length.
The title and content were concatenated before sent to the classifier.
As the loop progressed, it added my classifier and manually assigned categories to the list for each entry.
Then the train function from docclass.py was called and was not modified.
Listing \ref{code:first} is the modified code in feedfilter.py to accomplish this.\cite{bib:collective}

\lstset{
    caption={First 50 Classification},
     label=code:first
}
\lstinputlisting[language=Python, firstline=7, lastline=23]{feedfilter.py}

Next the second 50 entries had to classified by me and the classifier.
Additionally, the cprob had to be saved, so I modified docclass.py classify function to return it when a guess was given.
This allowed me to save both the predicted category and cprob for each in the entries list.
Listing \ref{code:second} is the additional code in feedfilter.py to accomplish this.\cite{bib:collective}
\lstset{
    caption={Second 50 Classification},
     label=code:second
}
\lstinputlisting[language=Python, firstline=25, lastline=44]{feedfilter.py}

In order to create the table, the title, classifier strings, predicted category, actual category, and cprob were sent to ``table.txt.''
The output file was then converted to ``table.tex,'' in order to create table \ref{tab:data}.
Listing \ref{code:table} is the code to output the data.\cite{bib:collective}
\lstset{
    caption={Table Data},
     label=code:table
}
\lstinputlisting[language=Python, firstline=54, lastline=63]{classify.py}



\input{table}


%----------------------------------------------------------------------------------------
%	TASK 3
%----------------------------------------------------------------------------------------
\section{Performance}
Assess the performance of your classifier in each of your categories
by computing precision, recall, and F1.
Note that the definitions
of precisions and recall are slightly different in the context of
classification; see:

http://en.wikipedia.org/wiki/Precision\_and\_recall\#Definition\_.28classification\_context.29

and

http://en.wikipedia.org/wiki/F1\_score

\subsection{Solution}
For a classifier, the expected prediction will be positive if labelled correctly and negative if not.
The observation will be true or false, as determined by external judgement.
A true positive (TP) is an entry labelled correctly.
A false negative (FN) would be an entry that was not labelled, but it should have been.  
This classifier did not have any FN.
A false positive (FP) was incorrectly labelled.\cite{bib:class}
Precision, or positive prediction value, was calculated as:
\[
\textrm{Precision}  = \frac{tp}{ tp + fp}
\]
The recall, or sensitivity, was calculated as:
\[
\textrm{Recall}  = \frac{tp}{tp + fn}
\]
The F1 score, or accuracy, was calculated as:
\[
F_1  = 2 * \frac{\textrm{precision}*\textrm{recall}}{\textrm{precision} + \textrm{recall}}
\]

Listing \ref{code:calc} is the code used to perform the calculations. \cite{bib:class},\cite{bib:f1}

\lstset{
    caption={Calculations},
     label=code:calc
}
\lstinputlisting[language=Python, firstline=67, lastline=81]{classify.py}

The classifier precision was only .58 and because there were no FN, the recall score was 1.
This provided an F1 score of 0.734.
I believe this was due to the lack of training for the paper and os categories.  
There were far fewer entries that belonged here, so they were not classified correctly by the classifier.
Perhaps if there had been more trained entries, it would have been higher.


Finally, all entries and data were output to ``entries.txt'' to be included in this report.\cite{bib:lfile}
Listing \ref{code:classify} in section \ref{sec:code} is the entire classify.py program and listing \ref{code:filter}, inthe same section
is feedfilter.py.
The file docclass.py, as used,  is included with this report.
\newpage
\section{Python Code}
\label{sec:code}
%%% Code Listing%%%%%

\lstset{
    language=python,
    caption={Complete Classifier},
     label=code:classify
}

\lstinputlisting{classify.py}

\lstset{
    language=python,
    caption={Modified Feed Filter},
     label=code:filter
}

\lstinputlisting{feedfilter.py}
\newpage 


\bibliography{references}{}
\bibliographystyle{plain}
\end{document}